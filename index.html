<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enciclop√©dia Imperial: Receitas do Mundo</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü•ò</text></svg>">
    
    <!-- Bibliotecas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.lordicon.com/lordicon.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'imperial-red': '#8B0000',
                        'imperial-gold': '#DAA520',
                        'cream': '#FDFBF7',
                        'stone-dark': '#292524'
                    },
                    fontFamily: {
                        serif: ['Playfair Display', 'serif'],
                        sans: ['Lato', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400;700&display=swap');

        body { font-family: 'Lato', sans-serif; background-color: #f8f9fa; color: #292524; }
        .serif-font { font-family: 'Playfair Display', serif; }

        .card-hover { transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #a8a29e; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        .img-loading {
            background-color: #e2e8f0;
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23cbd5e0' fill-rule='evenodd'%3E%3Cpath d='M0 40L40 0H20L0 20M40 40V20L20 40'/%3E%3C/g%3E%3C/svg%3E");
        }

        video:fullscreen { object-fit: contain; }

        /* Estilo para abas do admin */
        .admin-tab.active { border-bottom: 2px solid #8B0000; color: #8B0000; background: white; }
        
        /* Modal Styles Refined */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.5);
        }

        .magic-btn-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* Grid View Admin Styles */
        .admin-grid-card {
            transition: transform 0.2s;
        }
        .admin-grid-card:hover {
            transform: scale(1.02);
            border-color: #8B0000;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white sticky top-0 z-40 border-b border-gray-200 shadow-sm">
        <div class="container mx-auto px-4 pt-3 pb-2">
            <div class="flex flex-col md:flex-row justify-between items-center mb-3">
                
                <!-- Logo -->
                <div class="flex items-center space-x-3 mb-3 md:mb-0 cursor-pointer group" onclick="window.resetApp()">
                    <div class="w-12 h-12 rounded-full bg-imperial-red text-white flex items-center justify-center font-bold text-2xl shadow-lg group-hover:bg-red-800 transition ring-2 ring-offset-2 ring-imperial-gold">
                        È£ü
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold tracking-tight text-gray-900 serif-font">Enciclop√©dia Imperial</h1>
                        <p class="text-xs text-gray-500 font-bold uppercase tracking-wider">Gastronomia Global</p>
                    </div>
                </div>
                
                <!-- Ferramentas -->
                <div class="flex w-full md:w-auto items-center space-x-3">
                    <div class="relative flex-grow md:w-80">
                        <input type="text" id="searchInput" placeholder="O que voc√™ quer cozinhar hoje?" 
                            class="w-full pl-10 pr-4 py-2 rounded-full bg-gray-100 border-none focus:ring-2 focus:ring-imperial-red focus:bg-white transition text-sm">
                        <i class="fas fa-search absolute left-3.5 top-3 text-gray-400"></i>
                    </div>

                    <!-- Auth -->
                    <div id="authContainer">
                        <!-- Bot√£o modificado para abrir o modal de login (via admin panel overlay) -->
                        <button id="loginBtn" onclick="toggleAdminPanel()" class="hidden bg-imperial-red text-white hover:bg-red-800 font-bold py-2 px-4 rounded-full text-sm shadow transition">
                            <i class="fas fa-sign-in-alt mr-2"></i> Entrar / Admin
                        </button>
                        <div id="loginLoading" class="text-xs text-gray-400 animate-pulse">Conectando...</div>
                        
                        <div id="userProfile" class="hidden relative group cursor-pointer">
                            <img id="userPhoto" src="" class="w-10 h-10 rounded-full border-2 border-white shadow-md object-cover ring-2 ring-gray-100">
                            <!-- Menu Usuario (Ponte Invisivel) -->
                            <div class="absolute right-0 top-full pt-2 w-48 hidden group-hover:block z-50">
                                <div class="bg-white rounded-xl shadow-xl py-2 border border-gray-100 animate-fade-in">
                                    <div class="px-4 py-2 border-b border-gray-100">
                                        <p class="text-xs text-gray-500">Bem-vindo,</p>
                                        <p class="text-sm font-bold truncate" id="userName">Visitante</p>
                                    </div>
                                    <a href="#" onclick="showSavedRecipes()" class="block px-4 py-2 text-sm hover:bg-red-50 text-imperial-red font-bold">
                                        <i class="fas fa-heart mr-2"></i> Favoritos (<span id="savedCountDropdown">0</span>)
                                    </a>
                                    <a href="#" onclick="toggleAdminPanel()" class="block px-4 py-2 text-sm hover:bg-gray-50 text-gray-700">
                                        <i class="fas fa-tools mr-2"></i> Painel Admin
                                    </a>
                                    <a href="#" onclick="handleLogout()" class="block px-4 py-2 text-sm hover:bg-gray-50 text-gray-700">Sair</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navega√ß√£o Categorias -->
            <div class="w-full pt-1 border-t border-gray-100">
                <div class="overflow-x-auto scrollbar-hide flex justify-start md:justify-center px-1 pb-1">
                    <div class="flex space-x-2 min-w-max py-2" id="navCategories">
                        <!-- Injetado via JS -->
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Conte√∫do Principal -->
    <main class="container mx-auto px-4 py-8 flex-grow">
        <div class="flex justify-between items-end mb-8 border-b border-gray-200 pb-4">
            <div>
                <h2 class="text-3xl font-bold text-stone-900 serif-font" id="currentCatTitle">Cat√°logo Completo</h2>
                <p class="text-sm text-gray-500 mt-1 flex items-center">
                    <span id="dbStatus" class="inline-block w-2 h-2 rounded-full bg-green-500 mr-2"></span>
                    Sincronizado na Nuvem
                </p>
            </div>
            <span class="text-xs font-semibold bg-cream text-stone-600 px-3 py-1 rounded-full border border-stone-200" id="totalCount">Carregando...</span>
        </div>

        <div id="recipeGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>

        <div id="loadMoreContainer" class="text-center py-12 hidden">
            <button onclick="loadMore()" class="bg-white border border-stone-300 text-stone-600 hover:text-imperial-red hover:border-imperial-red font-bold py-3 px-10 rounded-full shadow-sm transition hover:shadow-md">Carregar Mais Receitas</button>
        </div>
        
        <div id="emptyState" class="hidden text-center py-24">
            <i class="fas fa-search text-4xl text-gray-300 mb-2"></i>
            <p class="text-gray-500 font-serif italic">Nenhuma receita encontrada para sua busca.</p>
        </div>
    </main>

    <!-- Footer Profissional -->
    <footer class="bg-stone-900 text-stone-400 pt-16 pb-8 mt-12 border-t border-stone-800">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
                <!-- Sobre -->
                <div class="col-span-1 md:col-span-1">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-10 h-10 rounded-full bg-imperial-red text-white flex items-center justify-center font-bold text-xl ring-2 ring-imperial-gold ring-offset-2 ring-offset-stone-900">È£ü</div>
                        <h3 class="text-xl font-bold text-stone-100 serif-font">Enciclop√©dia Imperial</h3>
                    </div>
                    <p class="text-sm text-stone-400 mb-6 leading-relaxed">
                        Sua fonte definitiva de receitas globais. Da culin√°ria chinesa milenar aos cl√°ssicos brasileiros, explorando sabores e tradi√ß√µes com ajuda da IA.
                    </p>
                </div>

                <!-- Categorias -->
                <div>
                    <h4 class="text-white font-bold mb-6 uppercase text-xs tracking-widest border-b border-stone-800 pb-2 inline-block">Explorar</h4>
                    <ul class="space-y-3 text-sm">
                        <li><a href="#" onclick="window.setCategory('brasileira')" class="hover:text-imperial-gold transition flex items-center"><i class="fas fa-chevron-right text-[10px] mr-2 opacity-50"></i> Receitas Brasileiras</a></li>
                        <li><a href="#" onclick="window.setCategory('chinesa')" class="hover:text-imperial-gold transition flex items-center"><i class="fas fa-chevron-right text-[10px] mr-2 opacity-50"></i> Receitas Chinesas</a></li>
                        <li><a href="#" onclick="window.setCategory('sobremesa')" class="hover:text-imperial-gold transition flex items-center"><i class="fas fa-chevron-right text-[10px] mr-2 opacity-50"></i> Doces & Sobremesas</a></li>
                    </ul>
                </div>

                <!-- Links √öteis -->
                <div>
                    <h4 class="text-white font-bold mb-6 uppercase text-xs tracking-widest border-b border-stone-800 pb-2 inline-block">Institucional</h4>
                    <ul class="space-y-3 text-sm">
                        <li><a href="#" class="hover:text-white transition">Termos de Uso</a></li>
                        <li><a href="#" onclick="toggleAdminPanel()" class="text-stone-600 hover:text-imperial-red transition text-xs"><i class="fas fa-lock mr-1"></i> √Årea Administrativa</a></li>
                    </ul>
                </div>

                <!-- Contato -->
                <div>
                    <h4 class="text-white font-bold mb-6 uppercase text-xs tracking-widest border-b border-stone-800 pb-2 inline-block">Contato</h4>
                    <ul class="space-y-3 text-sm">
                        <li class="flex items-start"><i class="fas fa-map-marker-alt mt-1 mr-3 text-imperial-red"></i> <span class="text-stone-400">Av. das Na√ß√µes, 1000<br>S√£o Paulo, SP</span></li>
                        <li class="flex items-center"><i class="fas fa-envelope mr-3 text-imperial-red"></i> <a href="mailto:contato@imperial.com" class="hover:text-white transition">contato@imperial.com</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-stone-800 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-stone-600">
                <p>&copy; 2024 Enciclop√©dia Imperial. Todos os direitos reservados.</p>
                <p class="mt-2 md:mt-0">Feito com <i class="fas fa-heart text-imperial-red mx-1"></i> para o mundo.</p>
            </div>
        </div>
    </footer>

    <!-- PAINEL ADMINISTRATIVO (Modal) -->
    <div id="adminModal" class="fixed inset-0 bg-black bg-opacity-90 z-[70] hidden flex items-center justify-center p-0 backdrop-blur-sm transition-all duration-300">
        <div class="bg-white rounded-none md:rounded-xl w-full max-w-6xl h-full md:h-[95vh] flex flex-col shadow-2xl overflow-hidden animate-fade-in relative">
            
            <!-- AUTH OVERLAY - Email & Password -->
            <div id="adminAuthOverlay" class="absolute inset-0 bg-white/95 z-50 flex flex-col items-center justify-center hidden">
                <div class="bg-white p-8 rounded-2xl shadow-2xl border border-gray-100 max-w-md w-full relative">
                    <button onclick="toggleAdminPanel()" class="absolute top-4 right-4 text-gray-400 hover:text-red-500"><i class="fas fa-times"></i></button>
                    
                    <div class="text-center mb-6">
                        <i class="fas fa-user-shield text-4xl text-imperial-red mb-3"></i>
                        <h3 class="text-xl font-bold text-gray-800">Login Seguro</h3>
                        <p class="text-sm text-gray-500">Acesse para gerenciar receitas</p>
                    </div>

                    <!-- Email/Senha Form -->
                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">EMAIL</label>
                            <input type="email" id="authEmail" class="w-full p-3 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-imperial-red outline-none text-sm" placeholder="seu@email.com">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">SENHA</label>
                            <input type="password" id="authPass" class="w-full p-3 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-imperial-red outline-none text-sm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <button onclick="handleEmailLogin()" class="w-full bg-stone-800 text-white font-bold py-3 rounded-lg hover:bg-black transition shadow-lg flex justify-center items-center">
                            <span id="btnLoginText">Entrar com Email</span>
                            <i id="authSpinner" class="fas fa-circle-notch fa-spin ml-2 hidden"></i>
                        </button>
                    </div>

                    <div class="relative flex py-2 items-center">
                        <div class="flex-grow border-t border-gray-200"></div>
                        <span class="flex-shrink-0 mx-4 text-gray-400 text-xs">N√£o tem conta?</span>
                        <div class="flex-grow border-t border-gray-200"></div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <a href="#" onclick="handleRegister()" class="text-sm font-bold text-imperial-red hover:underline">
                            <i class="fas fa-user-plus mr-1"></i> Criar Nova Conta
                        </a>
                    </div>
                </div>
            </div>

            <!-- Admin Header -->
            <div class="bg-gray-900 text-white p-4 flex justify-between items-center shrink-0 border-b border-gray-800">
                <div class="flex items-center">
                    <h2 class="text-xl font-bold flex items-center"><i class="fas fa-tools mr-3 text-imperial-red"></i> Painel Administrativo</h2>
                    <span class="ml-4 text-xs bg-gray-800 px-2 py-1 rounded text-gray-400 hidden md:inline-block">v2.4</span>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- BOT√ÉO DE SAIR -->
                    <button onclick="handleLogout()" class="text-red-400 hover:text-red-500 transition text-sm font-bold flex items-center border border-gray-700 px-3 py-1 rounded hover:bg-gray-800">
                        <i class="fas fa-sign-out-alt mr-2"></i> Sair
                    </button>
                    <div class="h-6 w-px bg-gray-700 mx-2"></div>
                    <button onclick="toggleAdminPanel()" class="text-gray-400 hover:text-white transition"><i class="fas fa-compress text-xl"></i></button>
                    <button onclick="toggleAdminPanel()" class="text-gray-400 hover:text-red-500 transition"><i class="fas fa-times text-2xl"></i></button>
                </div>
            </div>

            <!-- Admin Tabs -->
            <div class="flex border-b border-gray-200 bg-gray-50 shrink-0 overflow-x-auto">
                <button onclick="switchAdminTab('magic')" id="btn-tab-magic" class="admin-tab active flex-1 py-4 text-sm font-bold text-gray-600 hover:bg-white focus:outline-none whitespace-nowrap px-4 magic-text-gradient">
                    <i class="fas fa-wand-magic-sparkles mr-2 text-purple-600"></i> IA & Pollinations
                </button>
                <button onclick="switchAdminTab('add')" id="btn-tab-add" class="admin-tab active flex-1 py-4 text-sm font-bold text-gray-600 hover:bg-white focus:outline-none whitespace-nowrap px-4">
                    <i class="fas fa-plus-circle mr-2"></i> Adicionar/Editar
                </button>
                <button onclick="switchAdminTab('manage')" id="btn-tab-manage" class="admin-tab flex-1 py-4 text-sm font-bold text-gray-600 hover:bg-white focus:outline-none whitespace-nowrap px-4">
                    <i class="fas fa-list mr-2"></i> Gerenciar (Sync)
                </button>
                <button onclick="switchAdminTab('backup')" id="btn-tab-backup" class="admin-tab flex-1 py-4 text-sm font-bold text-gray-600 hover:bg-white focus:outline-none whitespace-nowrap px-4">
                    <i class="fas fa-database mr-2"></i> Backup
                </button>
            </div>

            <!-- Admin Content -->
            <div class="p-6 overflow-y-auto bg-gray-50 flex-grow">
                
                <!-- TAB: Gerador M√°gico (Pollinations) -->
                <div id="tab-magic" class="admin-content space-y-4">
                    <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-6 rounded-xl border border-purple-100 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold text-purple-900 text-lg"><i class="fas fa-robot mr-2"></i> Gerador de Receitas com IA</h3>
                            <div class="text-xs text-gray-500">Powered by Pollinations.ai</div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-xs font-bold text-gray-500 mb-1">O QUE VOC√ä QUER CRIAR?</label>
                            <input type="text" id="magicPrompt" class="w-full p-4 text-lg border-2 border-purple-200 rounded-lg focus:border-purple-500 focus:ring-0 outline-none" placeholder="Ex: Uma lasanha de berinjela vegetariana muito cremosa...">
                        </div>

                        <div class="mb-4">
                            <label class="block text-xs font-bold text-gray-400 mb-1">CHAVE API (Opcional / Salva)</label>
                            <input type="password" id="apiKeyInput" value="pk_9ufESLR0VsgQrg4U" class="w-full p-2 bg-white border rounded text-xs text-gray-500 font-mono">
                            <p class="text-[10px] text-gray-400 mt-1">Chave API preservada para backend customizado. O padr√£o usa Pollinations Public API.</p>
                        </div>

                        <button onclick="generateRecipeAI()" id="btnGenerateAI" class="w-full magic-btn-gradient text-white py-4 rounded-lg font-bold shadow-lg hover:opacity-90 transition transform active:scale-95 flex justify-center items-center">
                            <span id="aiBtnText"><i class="fas fa-wand-magic mr-2"></i> Criar Receita M√°gica</span>
                            <i id="aiSpinner" class="fas fa-circle-notch fa-spin ml-2 hidden"></i>
                        </button>

                        <div id="aiStatus" class="mt-4 text-center text-sm font-medium text-purple-700 hidden">
                            Processando...
                        </div>
                    </div>

                    <!-- Manual Paste Fallback -->
                    <div class="mt-8 pt-8 border-t border-gray-200">
                        <h4 class="text-sm font-bold text-gray-500 mb-2">Importa√ß√£o Manual de Texto</h4>
                        <textarea id="magicPaste" class="w-full h-24 p-4 border rounded text-sm bg-white" placeholder="Cole o texto de uma receita aqui para tentar extrair dados automaticamente..."></textarea>
                        <button onclick="parseMagicText()" class="mt-2 bg-gray-200 text-gray-700 px-4 py-1 rounded text-xs font-bold hover:bg-gray-300">
                            Processar Texto Manualmente
                        </button>
                    </div>
                </div>

                <!-- TAB: Adicionar Manual -->
                <div id="tab-add" class="admin-content hidden space-y-4">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <div class="flex justify-between items-center mb-6 pb-4 border-b">
                            <h3 class="font-bold text-gray-800">Editor de Receita</h3>
                            <button onclick="clearForm()" class="text-xs text-red-500 hover:underline">Limpar Formul√°rio</button>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="col-span-2">
                                <label class="block text-xs font-bold text-gray-500 mb-1">NOME DA RECEITA</label>
                                <input type="text" id="addName" placeholder="Ex: Feijoada Suprema" class="p-3 border rounded w-full focus:ring-2 focus:ring-imperial-red outline-none">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">CATEGORIA</label>
                                <select id="addCategory" class="p-3 border rounded w-full bg-white outline-none">
                                    <!-- Preenchido via JS -->
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">URL DA IMAGEM</label>
                                <div class="flex">
                                    <input type="text" id="addImage" placeholder="https://..." class="p-3 border rounded-l w-full outline-none text-xs">
                                    <button onclick="regenerateImage()" class="bg-gray-100 border border-l-0 px-3 rounded-r hover:bg-gray-200" title="Regerar Imagem com IA"><i class="fas fa-sync"></i></button>
                                </div>
                            </div>
                            <div class="h-20 bg-gray-100 rounded overflow-hidden relative">
                                <img id="imagePreview" src="" class="w-full h-full object-cover opacity-50">
                                <span class="absolute inset-0 flex items-center justify-center text-xs text-gray-400">Preview</span>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-xs font-bold text-gray-500 mb-1">DESCRI√á√ÉO CURTA</label>
                            <textarea id="addDesc" placeholder="Uma breve descri√ß√£o do prato..." class="p-3 border rounded w-full h-20 outline-none resize-none"></textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">INGREDIENTES (um por linha)</label>
                                <textarea id="addIng" class="p-3 border rounded w-full h-48 font-mono text-sm outline-none resize-none" placeholder="- 500g de Feij√£o&#10;- 2 Cebolas"></textarea>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1">MODO DE PREPARO (um por linha)</label>
                                <textarea id="addSteps" class="p-3 border rounded w-full h-48 font-mono text-sm outline-none resize-none" placeholder="1. Cozinhe o feij√£o&#10;2. Refogue a cebola"></textarea>
                            </div>
                        </div>
                        <button onclick="saveRecipe()" class="w-full mt-6 bg-green-600 text-white py-4 rounded font-bold hover:bg-green-700 shadow-lg transform active:scale-95 transition flex justify-center items-center">
                            <i class="fas fa-save mr-2"></i> Salvar Receita no Banco de Dados
                        </button>
                    </div>
                </div>

                <!-- TAB: Gerenciar Receitas (REFORMULADA) -->
                <div id="tab-manage" class="admin-content hidden flex flex-col h-full">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden flex flex-col h-full">
                        
                        <!-- Barra de Ferramentas -->
                        <div class="p-4 border-b border-gray-200 bg-gray-50 flex flex-col md:flex-row justify-between items-center gap-4 shrink-0">
                            <!-- Busca -->
                            <div class="relative w-full md:w-1/3">
                                <input type="text" id="adminSearch" oninput="window.adminState.page=1; window.renderAdminListLogic()" placeholder="Filtrar por nome..." class="pl-9 pr-4 py-2 border rounded-full w-full text-sm focus:outline-none focus:ring-1 focus:ring-imperial-red">
                                <i class="fas fa-search absolute left-3 top-2.5 text-gray-400 text-xs"></i>
                            </div>

                            <!-- Controles -->
                            <div class="flex items-center space-x-3 w-full md:w-auto justify-end">
                                <!-- View Mode -->
                                <div class="bg-white border border-gray-300 rounded-lg p-1 flex">
                                    <button onclick="setAdminView('list')" id="btnViewList" class="px-3 py-1 rounded text-gray-600 hover:bg-gray-100 transition"><i class="fas fa-list"></i></button>
                                    <button onclick="setAdminView('grid')" id="btnViewGrid" class="px-3 py-1 rounded text-gray-400 hover:bg-gray-100 transition"><i class="fas fa-th-large"></i></button>
                                </div>
                                
                                <!-- Pagina√ß√£o Select -->
                                <div class="flex items-center space-x-2">
                                    <label class="text-xs font-bold text-gray-500 hidden md:block">Mostrar:</label>
                                    <select onchange="setAdminPerPage(this.value)" class="border border-gray-300 rounded-lg p-1.5 text-sm bg-white outline-none focus:border-imperial-red">
                                        <option value="20">20</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                        <option value="all">Todos</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Area de Conte√∫do Scroll√°vel -->
                        <div id="adminListContainer" class="overflow-y-auto flex-grow custom-scroll p-0 relative">
                            <!-- Tabela ou Grid ser√° injetado aqui -->
                            <table class="w-full text-sm text-left text-gray-500" id="adminTableEl">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50 sticky top-0 z-10 shadow-sm">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Imagem</th>
                                        <th scope="col" class="px-6 py-3">Nome</th>
                                        <th scope="col" class="px-6 py-3">Categoria</th>
                                        <th scope="col" class="px-6 py-3 text-right">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="adminRecipeTbody">
                                    <!-- Rows -->
                                </tbody>
                            </table>
                            <div id="adminGridEl" class="hidden grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 p-4">
                                <!-- Cards -->
                            </div>
                        </div>

                        <!-- Rodap√© de Pagina√ß√£o -->
                        <div class="p-3 border-t border-gray-200 bg-white flex justify-between items-center shrink-0">
                            <span class="text-xs text-gray-500" id="adminPageInfo">Carregando...</span>
                            <div class="flex space-x-2">
                                <button onclick="changeAdminPage(-1)" id="btnAdminPrev" class="px-3 py-1 border rounded hover:bg-gray-50 text-xs font-bold disabled:opacity-50">Anterior</button>
                                <button onclick="changeAdminPage(1)" id="btnAdminNext" class="px-3 py-1 border rounded hover:bg-gray-50 text-xs font-bold disabled:opacity-50">Pr√≥ximo</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: Backup & Sync -->
                <div id="tab-backup" class="admin-content hidden text-center pt-10">
                    <div class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-lg border border-gray-200">
                        <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-4"></i>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Gest√£o de Dados</h3>
                        <p class="text-gray-500 mb-6">Total de Receitas Locais + Nuvem: <span id="adminTotalCount" class="font-bold text-gray-900">0</span></p>
                        
                        <div class="space-y-3">
                            <button onclick="downloadBackup()" class="w-full bg-gray-800 text-white py-3 rounded hover:bg-black transition">
                                <i class="fas fa-download mr-2"></i> Baixar Backup Completo (.json)
                            </button>
                            <label class="block w-full bg-gray-100 text-gray-700 py-3 rounded hover:bg-gray-200 cursor-pointer border border-gray-300 transition">
                                <i class="fas fa-upload mr-2"></i> Restaurar Backup
                                <input type="file" class="hidden" onchange="restoreBackup(this)">
                            </label>
                            <button onclick="syncGeneratedToFirebase()" class="w-full bg-orange-600 text-white py-3 rounded hover:bg-orange-700 transition">
                                <i class="fas fa-sync mr-2"></i> Sincronizar Tudo (Firebase)
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal Receita -->
    <div id="recipeModal" class="fixed inset-0 bg-stone-900 bg-opacity-95 z-50 hidden flex items-center justify-center p-0 md:p-4 backdrop-blur-md transition-opacity">
        <div class="bg-cream rounded-none md:rounded-3xl w-full max-w-6xl h-full md:h-[95vh] flex flex-col shadow-2xl overflow-hidden animate-fade-in relative border border-stone-200">
            
            <!-- Header Modal Imagem -->
            <div class="relative h-56 md:h-64 shrink-0 bg-stone-100 group">
                <img id="modalImage" src="" class="w-full h-full object-cover" onerror="this.src=window.DEFAULT_IMAGE">
                
                <div class="absolute inset-0 bg-gradient-to-t from-stone-900 via-stone-900/40 to-transparent"></div>
                <button onclick="event.stopPropagation(); window.closeModal()" class="absolute top-4 right-4 bg-black/40 hover:bg-black/80 text-white w-10 h-10 rounded-full flex items-center justify-center transition backdrop-blur-md z-20"><i class="fas fa-times text-lg"></i></button>

                <div class="absolute bottom-0 left-0 w-full p-8 text-white z-10 pointer-events-none">
                    <div class="flex items-center space-x-3 mb-2">
                        <div class="flex text-imperial-gold text-sm" id="modalRating"></div>
                    </div>
                    <h2 id="modalTitle" class="text-3xl md:text-5xl font-bold serif-font leading-tight drop-shadow-xl text-shadow">T√≠tulo</h2>
                </div>
            </div>

            <!-- Toolbar -->
            <div class="bg-white border-b border-stone-200 px-8 py-4 flex justify-between items-center shrink-0">
                <div class="flex space-x-6 text-sm font-bold text-stone-600">
                    <span class="flex items-center"><i class="far fa-clock text-imperial-red mr-2"></i> <span id="modalTime"></span></span>
                    <span class="hidden md:flex items-center"><i class="fas fa-fire text-orange-500 mr-2"></i> <span id="modalFunction"></span></span>
                </div>
                <div class="flex space-x-3">
                    <button id="ttsBtn" onclick="window.toggleTTS()" class="flex items-center space-x-2 px-4 py-2 rounded-full bg-stone-100 hover:bg-stone-200 text-stone-700 transition text-sm font-bold" title="Ouvir">
                        <i class="fas fa-volume-up"></i> <span class="hidden md:inline">Ouvir</span>
                    </button>
                    <button onclick="window.toggleTextZoom()" class="flex items-center space-x-2 px-4 py-2 rounded-full bg-stone-100 hover:bg-stone-200 text-stone-700 transition text-sm font-bold" title="Aumentar Texto">
                        <i class="fas fa-font"></i>
                    </button>
                    <button onclick="window.shareRecipeFromModal()" class="flex items-center space-x-2 px-4 py-2 rounded-full bg-blue-50 hover:bg-blue-100 text-blue-600 transition text-sm font-bold" title="Compartilhar">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    <button onclick="window.toggleSaveRecipe(window.currentModalRecipeId)" id="modalSaveBtn" class="flex items-center space-x-2 px-4 py-2 rounded-full bg-stone-100 hover:bg-pink-50 text-stone-600 hover:text-pink-600 transition text-sm font-bold" title="Salvar">
                        <i class="far fa-heart"></i>
                    </button>
                </div>
            </div>

            <!-- Conte√∫do (Layout Sofisticado) -->
            <div class="flex flex-col md:flex-row overflow-hidden flex-grow bg-cream" id="modalScrollContainer">
                
                <!-- Coluna Esquerda: V√≠deo e Ingredientes -->
                <div class="md:w-1/3 bg-white p-8 border-r border-stone-100 overflow-y-auto custom-scroll" id="modalLeftCol">
                    <!-- V√≠deo Embutido -->
                    <div class="mb-8 rounded-xl overflow-hidden shadow-lg border border-stone-200 bg-black relative group">
                        <video id="modalVideo" controls class="w-full aspect-video" poster="">
                            <source src="https://videos.pexels.com/video-files/2882090/2882090-hd_1920_1080_24fps.mp4" type="video/mp4">
                        </video>
                    </div>

                    <h3 class="font-serif font-bold text-imperial-red text-2xl mb-4 border-b border-stone-200 pb-2">
                        Ingredientes
                    </h3>
                    <ul id="modalIngredients" class="space-y-3 text-sm text-stone-700"></ul>
                </div>

                <!-- Coluna Direita: Modo de Preparo -->
                <div class="md:w-2/3 p-8 overflow-y-auto custom-scroll" id="modalRightCol">
                    <h3 class="font-serif font-bold text-imperial-red text-2xl mb-4 border-b border-stone-200 pb-2">
                        Modo de Preparo
                    </h3>
                    
                    <div id="modalSteps" class="space-y-6 text-stone-800 leading-relaxed text-lg font-light mb-10"></div>

                    <p id="modalDesc" class="text-stone-600 italic text-base bg-stone-50 p-6 rounded-lg border-l-4 border-imperial-gold shadow-sm mt-8"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT PRINCIPAL (L√≥gica UI, Dados, Admin, AI) -->
    <script>
        // CONFIGURA√á√ïES GLOBAIS
        window.DEFAULT_IMAGE = "https://images.pexels.com/photos/31495671/pexels-photo-31495671.jpeg";
        
        // ESTADO GLOBAL
        window.generatedRecipes = [];
        window.finalRecipeList = [];
        window.firebaseRecipes = [];
        window.savedRecipesSet = new Set();
        window.currentModalRecipeId = null;
        window.currentCategory = 'all';
        window.textZoomLevel = 0;
        window.isUserAdmin = false;

        // ESTADO DO ADMIN
        window.adminState = {
            page: 1,
            perPage: 20,
            view: 'list', // 'list' | 'grid'
        };

        // Categorias e Metadados
        const categories = {
            'brasileira': { label: 'üáßüá∑ Brasil', icon: 'https://cdn.lordicon.com/qhgmphtg.json', flavor: 'Tradicional' }, 
            'chinesa': { label: 'üá®üá≥ China', icon: 'https://cdn.lordicon.com/ulnswmkk.json', flavor: 'Umami' },
            'natal': { label: 'üéÑ Natal', icon: 'https://cdn.lordicon.com/fihkmkwt.json', flavor: 'Festivo' },
            'suco': { label: 'üçπ Sucos', icon: 'https://cdn.lordicon.com/pbrgppbb.json', flavor: 'Refrescante' },
            'sopa': { label: 'ü•£ Sopas', icon: 'https://cdn.lordicon.com/gqzfzudq.json', flavor: 'Reconfortante' },
            'bolo': { label: 'üç∞ Bolos', icon: 'https://cdn.lordicon.com/ivhjpjsw.json', flavor: 'Doce' },
            'carne': { label: 'ü•© Carnes', icon: 'https://cdn.lordicon.com/xryjrepg.json', flavor: 'Salgado' },
            'ave': { label: 'üçó Aves', icon: 'https://cdn.lordicon.com/hifghsbr.json', flavor: 'Assado' },
            'peixe': { label: 'üêü Peixes', icon: 'https://cdn.lordicon.com/drtetngs.json', flavor: 'Leve' },
            'massa': { label: 'üçù Massas', icon: 'https://cdn.lordicon.com/tqvgdoln.json', flavor: 'Italiano' },
            'salada': { label: 'ü•ó Saladas', icon: 'https://cdn.lordicon.com/sbiheqdr.json', flavor: 'Saud√°vel' },
            'sobremesa': { label: 'üçÆ Doces', icon: 'https://cdn.lordicon.com/yxyampds.json', flavor: 'Sobremesa' },
            'medicinal': { label: 'üíä Sa√∫de', icon: 'https://cdn.lordicon.com/puvaffet.json', flavor: 'Nutritivo' },
            'bebida': { label: 'üçµ Bebidas', icon: 'https://cdn.lordicon.com/pbrgppbb.json', flavor: 'Quente/Frio' },
            'entrada': { label: 'ü•ü Entradas', icon: 'https://cdn.lordicon.com/gqzfzudq.json', flavor: 'Aperitivo' },
            'principal': { label: 'ü•ò Pratos', icon: 'https://cdn.lordicon.com/xryjrepg.json', flavor: 'Completo' }
        };

        // Renderiza Menu de Categorias
        const menuContainer = document.getElementById('navCategories');
        const menuKeys = ['all', 'brasileira', 'chinesa', 'natal', 'bolo', 'carne', 'massa', 'sobremesa', 'suco', 'sopa', 'ave', 'peixe', 'salada', 'medicinal', 'saved'];
        
        menuKeys.forEach(key => {
            const btn = document.createElement('button');
            const info = categories[key] || { label: key === 'all' ? 'Todos' : (key === 'saved' ? '‚ù§Ô∏è Favoritos' : key) };
            
            btn.className = `cat-btn px-5 py-2 rounded-full text-xs font-bold transition border border-stone-200 bg-white text-stone-600 hover:bg-stone-50 mr-3 mb-1 whitespace-nowrap shadow-sm hover:shadow`;
            if (key === 'all') btn.classList.add('bg-stone-800', 'text-white', 'border-transparent', 'hover:bg-black');
            if (key === 'saved') btn.classList.add('border-pink-200', 'text-pink-600', 'hover:bg-pink-50');
            
            btn.innerText = info.label;
            btn.dataset.cat = key;
            btn.onclick = () => setCategory(key);
            menuContainer.appendChild(btn);
        });

        // Popula o select do admin
        const catSelect = document.getElementById('addCategory');
        Object.keys(categories).forEach(k => {
            const opt = document.createElement('option');
            opt.value = k;
            opt.innerText = categories[k].label;
            catSelect.appendChild(opt);
        });

        // --- GERA√á√ÉO DE IMAGEM IA (Pollinations) ---
        function getPollinationsImage(prompt) {
            const encoded = encodeURIComponent("professional food photography " + prompt + ", high detail, 8k, culinary magazine style");
            return `https://image.pollinations.ai/prompt/${encoded}?nologo=true&seed=${Math.floor(Math.random() * 1000)}`;
        }

        // --- RESTAURA√á√ÉO: GERA√á√ÉO DE MOCK DATA (1000 Receitas) ---
        const ingredientsPool = {
            suco: ["Laranja", "Abacaxi", "Hortel√£", "Gengibre", "Couve", "Lim√£o", "A√ß√∫car", "Gelo", "√Ågua de Coco", "Morango"],
            sopa: ["Batata", "Cenoura", "Mandioquinha", "Cebola", "Alho", "Caldo de Carne", "Macarr√£o", "Frango Desfiado", "Azeite"],
            bolo: ["Farinha de Trigo", "Ovos", "A√ß√∫car", "Leite", "Manteiga", "Fermento", "Chocolate em P√≥", "Cenoura", "Fub√°"],
            natal: ["Peru", "Chester", "Farofa", "Uvas Passas", "Nozes", "Bacalhau", "Arroz √† Grega", "Salpic√£o", "Rabanada"],
            carne: ["Picanha", "Alcatra", "Maminha", "Sal Grosso", "Alho", "Manteiga", "Alecrim", "Pimenta do Reino"],
            ave: ["Frango Inteiro", "Peito de Frango", "Coxa e Sobrecoxa", "Lim√£o", "Curry", "Batatas", "Maionese"],
            peixe: ["Til√°pia", "Salm√£o", "Camar√£o", "Leite de Coco", "Dend√™", "Coentro", "Piment√£o", "Tomate"],
            massa: ["Macarr√£o Espaguete", "Penne", "Molho de Tomate", "Queijo Parmes√£o", "Manjeric√£o", "Carne Mo√≠da", "Creme de Leite"],
            salada: ["Alface", "R√∫cula", "Tomate Cereja", "Pepino", "Manga", "Queijo Branco", "Azeite", "Mostarda e Mel"],
            brasileira: ["Feij√£o Preto", "Arroz", "Farofa", "Couve", "Carne Seca"],
            chinesa: ["Shoyu", "Gengibre", "Macarr√£o", "Amendoim", "Frango"],
            sobremesa: ["Leite Condensado", "Chocolate", "Morango", "Creme de Leite", "Biscoito"]
        };
        
        const nameModifiers = {
            adjectives: ['Supremo', 'Divino', 'Cremoso', 'da Vov√≥', 'R√∫stico', 'Imperial', 'Tradicional', 'Festivo', 'Suculento', 'Crocante', 'Especial', 'Caseiro', 'Fresco'],
            origins: ['Mineiro', 'Baiano', 'Carioca', 'Italiano', 'Chin√™s', 'Tailand√™s', 'do Campo', 'da Fazenda', 'do Mar', 'Serrano', 'Nordestino'],
            styles: ['ao Forno', 'Grelhado', 'Frito', 'Assado', 'Refogado', 'ao Molho', 'na Brasa', 'Vaporizado', 'Gratinado']
        };

        function getRandom(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

        function generateUniqueName(category, type) {
            const patterns = [
                () => `${type} ${getRandom(nameModifiers.adjectives)}`,
                () => `${type} ${getRandom(nameModifiers.origins)}`,
                () => `${type} ${getRandom(nameModifiers.styles)}`,
                () => `${getRandom(nameModifiers.adjectives)} ${type}`
            ];
            const pattern = patterns[Math.floor(Math.random() * patterns.length)];
            return pattern();
        }

        function generateRecipe(id, category, type) {
            const name = generateUniqueName(category, type);
            // Default image logic
            const image = window.DEFAULT_IMAGE; 
            
            // Random ingredients
            const catKey = (category === 'brasileira' || category === 'chinesa') ? 'carne' : (ingredientsPool[category] ? category : 'sopa');
            const ingSource = ingredientsPool[catKey] || ingredientsPool['carne'];
            const ingredients = [];
            for(let i=0; i<5; i++) ingredients.push(ingSource[Math.floor(Math.random() * ingSource.length)]);

            return {
                id: id,
                name: name,
                category: category,
                image: image,
                desc: `Uma deliciosa e aut√™ntica receita de ${category} para sua mesa. Sabor inigual√°vel e preparo especial.`,
                func: categories[category]?.flavor || 'Sabor',
                time: `${Math.floor(Math.random() * 40) + 20} min`,
                ingredients: ingredients,
                steps: ["Passo 1: Prepare todos os ingredientes.", "Passo 2: Misture tudo com cuidado.", "Passo 3: Cozinhe em fogo m√©dio por 20 minutos.", "Passo 4: Sirva quente e aproveite!"],
                rating: (Math.random() * (5.0 - 4.2) + 4.2).toFixed(1)
            };
        }
        
        // Populate 1000 recipes
        let genId = 1000;
        function populate() {
             const baseTypes = {
                suco: ['Suco', 'Vitamina', 'Smoothie', 'Refresco', 'Drink'],
                sopa: ['Sopa', 'Caldo', 'Creme', 'Consom√™'],
                bolo: ['Bolo', 'Torta', 'Rocambole'], carne: ['Bife', 'Assado', 'Picadinho'],
                brasileira: ['Feijoada', 'Vatap√°', 'Moqueca'], chinesa: ['Yakisoba', 'Pato', 'Rolinho'],
                ave: ['Frango', 'Peru', 'Chester'], peixe: ['Peixe', 'Moqueca', 'Fil√©'],
                massa: ['Macarr√£o', 'Lasanha', 'Nhoque'], salada: ['Salada', 'Mix', 'Bowl'],
                sobremesa: ['Pudim', 'Mousse', 'Pav√™'], medicinal: ['Ch√°', 'Xarope', 'Infus√£o']
            };
            
            const cats = Object.keys(categories);
            // Limit slightly to keep performance ok in browser
            const perCat = 60; 
            
            cats.forEach(cat => {
                const types = baseTypes[cat] || ['Prato', 'Del√≠cia', 'Especialidade'];
                for(let i=0; i<perCat; i++) {
                    const type = types[Math.floor(Math.random() * types.length)];
                    window.generatedRecipes.push(generateRecipe(genId++, cat, type));
                }
            });
        }

        // --- RENDERIZA√á√ÉO ---
        window.currentCategory = 'all';
        let filtered = [];
        let page = 1;
        const perPage = 24;

        window.filterRecipes = () => {
            page = 1;
            const term = document.getElementById('searchInput').value.toLowerCase();
            const grid = document.getElementById('recipeGrid');
            grid.innerHTML = '';
            
            if(window.currentCategory === 'saved') {
                filtered = window.finalRecipeList.filter(r => window.savedRecipesSet.has(String(r.id)));
            } else if(window.currentCategory === 'all') {
                filtered = window.finalRecipeList;
            } else {
                filtered = window.finalRecipeList.filter(r => r.category === window.currentCategory);
            }
            
            if(term) filtered = filtered.filter(r => r.name.toLowerCase().includes(term));

            document.getElementById('totalCount').innerText = `${filtered.length} receitas`;
            
            if(filtered.length === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                document.getElementById('loadMoreContainer').classList.add('hidden');
            } else {
                document.getElementById('emptyState').classList.add('hidden');
                document.getElementById('loadMoreContainer').classList.remove('hidden');
                window.renderBatch();
            }
        };

        window.renderBatch = () => {
            const start = (page - 1) * perPage;
            const batch = filtered.slice(start, start + perPage);
            const grid = document.getElementById('recipeGrid');

            batch.forEach((r, i) => {
                const el = document.createElement('div');
                el.className = "bg-white rounded-xl shadow-sm border border-stone-100 overflow-hidden card-hover cursor-pointer group relative animate-fade-in";
                el.style.animationDelay = `${i*0.02}s`;
                el.onclick = () => window.openRecipe(r.id);

                const isFav = window.savedRecipesSet.has(String(r.id));
                // Fallback inteligente para imagem: Se n√£o tiver imagem definida, usa o DEFAULT
                const displayImage = (r.image && r.image.trim() !== "") ? r.image : window.DEFAULT_IMAGE;

                el.innerHTML = `
                    <div class="h-48 relative bg-stone-100 flex items-center justify-center overflow-hidden">
                        <img src="${displayImage}" class="w-full h-full object-cover transition duration-700 group-hover:scale-110 img-loading" 
                             onerror="this.src=window.DEFAULT_IMAGE">
                        <div class="absolute inset-0 bg-gradient-to-t from-stone-900/60 via-transparent to-transparent opacity-60"></div>
                        <div class="absolute top-2 right-2 bg-white/90 px-1.5 rounded text-[10px] font-bold shadow flex items-center">
                            <i class="fas fa-star text-imperial-gold mr-1"></i> ${r.rating || 4.5}
                        </div>
                        <button onclick="window.toggleSaveRecipe('${r.id}', event)" class="absolute bottom-2 right-2 w-8 h-8 rounded-full hover:bg-white/20 flex items-center justify-center transition z-10">
                            <i class="${isFav ? 'fas text-imperial-red' : 'far text-white'} fa-heart text-lg heart-icon transition transform hover:scale-110"></i>
                        </button>
                    </div>
                    <div class="p-4 bg-white">
                        <p class="text-[10px] text-imperial-red font-bold uppercase tracking-wider mb-1">${r.category || 'Geral'}</p>
                        <h3 class="font-bold text-stone-800 text-sm leading-tight mb-2 font-serif group-hover:text-imperial-red transition line-clamp-2">${r.name}</h3>
                        <div class="flex items-center text-xs text-stone-500 pt-2 border-t border-stone-50">
                             <span class="flex items-center"><i class="fas fa-tag mr-1 text-orange-400"></i> ${r.func || 'Sabor'}</span>
                             <span class="ml-auto flex items-center"><i class="fas fa-clock mr-1 text-gray-400"></i> ${r.time || '30m'}</span>
                        </div>
                    </div>
                `;
                grid.appendChild(el);
            });

            if(start + perPage >= filtered.length) document.getElementById('loadMoreContainer').classList.add('hidden');
        };

        window.loadMore = () => { page++; window.renderBatch(); };
        window.setCategory = (c) => { 
            window.currentCategory = c; 
            document.querySelectorAll('.cat-btn').forEach(b => {
                b.classList.remove('active-cat', 'bg-stone-800', 'text-white', 'border-transparent');
                b.classList.add('bg-white', 'text-stone-600', 'border-stone-200');
                if(b.dataset.cat === c) {
                    b.classList.remove('bg-white', 'text-stone-600', 'border-stone-200');
                    b.classList.add('active-cat', 'bg-stone-800', 'text-white', 'border-transparent');
                }
            });
            window.filterRecipes(); 
        };

        // --- PAINEL ADMIN E AUTH ---
        window.toggleAdminPanel = () => {
            const modal = document.getElementById('adminModal');
            const authOverlay = document.getElementById('adminAuthOverlay');
            
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                
                // Verifica autentica√ß√£o Firebase
                if(!window.isUserAdmin) {
                    authOverlay.classList.remove('hidden');
                } else {
                    authOverlay.classList.add('hidden');
                }
                
                // Inicializa a lista admin se ainda n√£o foi renderizada corretamente
                window.renderAdminListLogic();
            } else {
                modal.classList.add('hidden');
            }
        };

        window.switchAdminTab = (tab) => {
            document.querySelectorAll('.admin-content').forEach(e => e.classList.add('hidden'));
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
            document.querySelectorAll('.admin-tab').forEach(e => e.classList.remove('active'));
            document.getElementById(`btn-tab-${tab}`).classList.add('active');
            
            if(tab === 'manage') window.renderAdminListLogic();
        };
        
        // --- FUN√á√ÉO M√ÅGICA DE GERA√á√ÉO COM IA (POLLINATIONS) ---
        window.generateRecipeAI = async () => {
            const prompt = document.getElementById('magicPrompt').value;
            const btn = document.getElementById('btnGenerateAI');
            const btnText = document.getElementById('aiBtnText');
            const spinner = document.getElementById('aiSpinner');
            const status = document.getElementById('aiStatus');

            if(!prompt) { alert("Por favor, digite o que deseja criar."); return; }

            // UI Loading
            btn.disabled = true;
            btn.classList.add('opacity-75');
            btnText.innerText = "Criando Receita...";
            spinner.classList.remove('hidden');
            status.innerText = "Aguarde, a IA est√° escrevendo a receita...";
            status.classList.remove('hidden');

            try {
                // 1. Gera Texto usando Pollinations Text API (Model: OpenAI)
                const systemPrompt = `Voc√™ √© um chef gourmet especialista. Crie uma receita completa baseada em: "${prompt}". 
                Retorne APENAS um JSON v√°lido (sem markdown, sem blocos de c√≥digo) com a seguinte estrutura:
                {
                    "name": "Nome do Prato",
                    "category": "uma das chaves: brasileira, chinesa, natal, suco, sopa, bolo, carne, ave, peixe, massa, salada, sobremesa, entrada",
                    "desc": "Uma descri√ß√£o curta e apetitosa de 2 linhas",
                    "ingredients": ["ingrediente 1", "ingrediente 2"],
                    "steps": ["passo 1", "passo 2"],
                    "time": "tempo ex: 45 min",
                    "func": "perfil de sabor ex: Picante, Doce, Leve"
                }`;

                // Chamada √† API de Texto do Pollinations
                const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(systemPrompt)}?model=openai`);
                const textData = await response.text();
                
                // Limpeza e Parse do JSON
                let jsonString = textData.replace(/```json/g, '').replace(/```/g, '').trim();
                const recipeData = JSON.parse(jsonString);

                status.innerText = "Texto gerado! Criando imagem ilustrativa...";

                // 2. Preenche o Formul√°rio na Aba "Adicionar"
                document.getElementById('addName').value = recipeData.name;
                document.getElementById('addDesc').value = recipeData.desc;
                document.getElementById('addIng').value = recipeData.ingredients.join('\n');
                document.getElementById('addSteps').value = recipeData.steps.join('\n');
                
                // Tenta selecionar categoria correta, fallback para 'principal'
                const select = document.getElementById('addCategory');
                if(categories[recipeData.category]) {
                    select.value = recipeData.category;
                } else {
                    select.value = 'principal';
                }

                // 3. Gera Imagem usando Pollinations Image API
                const imageUrl = getPollinationsImage(`${recipeData.name} ${recipeData.desc}`);
                document.getElementById('addImage').value = imageUrl;
                
                // Atualiza Preview
                const imgPreview = document.getElementById('imagePreview');
                imgPreview.src = imageUrl;
                imgPreview.classList.remove('opacity-50');

                // Finaliza
                status.innerText = "Receita criada com sucesso! Verifique na aba Adicionar.";
                setTimeout(() => {
                    window.switchAdminTab('add');
                    status.classList.add('hidden');
                    btn.disabled = false;
                    btn.classList.remove('opacity-75');
                    btnText.innerHTML = '<i class="fas fa-wand-magic mr-2"></i> Criar Receita M√°gica';
                    spinner.classList.add('hidden');
                }, 1500);

            } catch (error) {
                console.error(error);
                status.innerText = "Erro ao gerar. Tente simplificar o pedido.";
                btn.disabled = false;
                btn.classList.remove('opacity-75');
                spinner.classList.add('hidden');
            }
        };

        window.regenerateImage = () => {
            const name = document.getElementById('addName').value;
            if(!name) return alert("Preencha o nome primeiro.");
            const url = getPollinationsImage(name);
            document.getElementById('addImage').value = url;
            document.getElementById('imagePreview').src = url;
        };

        window.clearForm = () => {
            document.getElementById('addName').value = '';
            document.getElementById('addDesc').value = '';
            document.getElementById('addImage').value = '';
            document.getElementById('addIng').value = '';
            document.getElementById('addSteps').value = '';
            document.getElementById('imagePreview').src = '';
        };

        window.saveRecipe = async () => {
            const name = document.getElementById('addName').value;
            const cat = document.getElementById('addCategory').value;
            const imgInput = document.getElementById('addImage').value;
            
            // L√≥gica do bot√£o m√°gico + imagem padr√£o se vazio
            const finalImage = (imgInput && imgInput.trim() !== "") ? imgInput : window.DEFAULT_IMAGE;

            const newRecipe = {
                id: Date.now(),
                name: name,
                category: cat,
                image: finalImage,
                desc: document.getElementById('addDesc').value,
                ingredients: document.getElementById('addIng').value.split('\n').filter(x => x.trim()),
                steps: document.getElementById('addSteps').value.split('\n').filter(x => x.trim()),
                rating: "5.0", 
                time: "45 min",
                func: categories[cat]?.flavor || "Especial"
            };
            
            // Salva Local e Firebase
            window.firebaseRecipes.unshift(newRecipe);
            window.mergeAndRender();
            window.saveRecipeToFirebase(newRecipe);
            
            alert("Receita Adicionada com Sucesso!");
            window.switchAdminTab('manage');
            window.clearForm();
        };

        window.parseMagicText = () => {
            const text = document.getElementById('magicPaste').value;
            const lines = text.split('\n').filter(l => l.trim());
            if(lines.length > 0) document.getElementById('addName').value = lines[0];
            const ings = lines.filter(l => l.includes('-') || l.match(/^\d/)).join('\n');
            document.getElementById('addIng').value = ings;
            window.switchAdminTab('add');
        };

        // --- GEST√ÉO DE DADOS (ADMIN AVAN√áADO) ---
        window.mergeAndRender = () => {
            const fbIds = new Set(window.firebaseRecipes.map(r => r.id));
            const uniqueGen = window.generatedRecipes.filter(r => !fbIds.has(r.id));
            window.finalRecipeList = [...window.firebaseRecipes, ...uniqueGen];
            window.filterRecipes();
            window.renderAdminListLogic(); // Atualiza a lista admin se aberta
        }

        // Fun√ß√µes de Controle da Lista Admin
        window.setAdminView = (mode) => {
            window.adminState.view = mode;
            document.getElementById('btnViewList').className = `px-3 py-1 rounded transition ${mode === 'list' ? 'bg-gray-100 text-imperial-red border-gray-300' : 'text-gray-400 hover:bg-gray-50'}`;
            document.getElementById('btnViewGrid').className = `px-3 py-1 rounded transition ${mode === 'grid' ? 'bg-gray-100 text-imperial-red border-gray-300' : 'text-gray-400 hover:bg-gray-50'}`;
            window.renderAdminListLogic();
        };

        window.setAdminPerPage = (val) => {
            window.adminState.perPage = val === 'all' ? 999999 : parseInt(val);
            window.adminState.page = 1;
            window.renderAdminListLogic();
        };

        window.changeAdminPage = (delta) => {
            const total = window.filteredAdminList ? window.filteredAdminList.length : 0;
            const maxPage = Math.ceil(total / window.adminState.perPage);
            const newPage = window.adminState.page + delta;
            
            if (newPage >= 1 && newPage <= maxPage) {
                window.adminState.page = newPage;
                window.renderAdminListLogic();
            }
        };

        window.renderAdminListLogic = () => {
            // Container references
            const tableEl = document.getElementById('adminTableEl');
            const gridEl = document.getElementById('adminGridEl');
            const tbody = document.getElementById('adminRecipeTbody');
            const pageInfo = document.getElementById('adminPageInfo');
            const btnPrev = document.getElementById('btnAdminPrev');
            const btnNext = document.getElementById('btnAdminNext');
            
            if(!tbody) return; // Se a aba n√£o estiver ativa/criada

            // 1. Filter
            const term = document.getElementById('adminSearch').value.toLowerCase();
            window.filteredAdminList = window.finalRecipeList.filter(r => (r.name || "").toLowerCase().includes(term));
            
            // 2. Pagination Logic
            const total = window.filteredAdminList.length;
            const perPage = window.adminState.perPage;
            const currentPage = window.adminState.page;
            const totalPages = Math.ceil(total / perPage);
            
            // Adjust page if out of bounds
            if (currentPage > totalPages && totalPages > 0) window.adminState.page = totalPages;
            if (currentPage < 1) window.adminState.page = 1;
            
            const start = (window.adminState.page - 1) * perPage;
            const end = start + perPage;
            const paginatedItems = window.filteredAdminList.slice(start, end);

            // 3. Update Controls
            pageInfo.innerText = total > 0 
                ? `Mostrando ${start + 1}-${Math.min(end, total)} de ${total}` 
                : 'Nenhum resultado';
            btnPrev.disabled = window.adminState.page <= 1;
            btnNext.disabled = window.adminState.page >= totalPages;

            document.getElementById('adminTotalCount').innerText = window.finalRecipeList.length;

            // 4. Render View
            if (window.adminState.view === 'list') {
                tableEl.classList.remove('hidden');
                gridEl.classList.add('hidden');
                
                let html = '';
                paginatedItems.forEach(r => {
                    const img = r.image || window.DEFAULT_IMAGE;
                    html += `
                        <tr class="bg-white border-b hover:bg-gray-50">
                            <td class="px-6 py-4">
                                <img class="w-10 h-10 rounded-full object-cover" src="${img}" onerror="this.src=window.DEFAULT_IMAGE">
                            </td>
                            <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${r.name}</td>
                            <td class="px-6 py-4"><span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">${r.category}</span></td>
                            <td class="px-6 py-4 text-right">
                                <button onclick="alert('Funcionalidade simulada: Excluir ${r.name}')" class="font-medium text-red-600 hover:underline"><i class="fas fa-trash-alt"></i></button>
                            </td>
                        </tr>
                    `;
                });
                tbody.innerHTML = html;
            } else {
                // Grid View
                tableEl.classList.add('hidden');
                gridEl.classList.remove('hidden');
                
                let html = '';
                paginatedItems.forEach(r => {
                    const img = r.image || window.DEFAULT_IMAGE;
                    html += `
                        <div class="admin-grid-card bg-white border border-gray-200 rounded-lg p-3 flex flex-col items-center text-center shadow-sm relative group">
                            <img class="w-20 h-20 rounded-full object-cover mb-2" src="${img}" onerror="this.src=window.DEFAULT_IMAGE">
                            <h4 class="font-bold text-sm text-gray-800 line-clamp-2 h-10 leading-tight">${r.name}</h4>
                            <span class="bg-gray-100 text-gray-600 text-[10px] px-2 py-0.5 rounded mt-2">${r.category}</span>
                            <button class="absolute top-2 right-2 text-red-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                });
                gridEl.innerHTML = html;
            }
        };

        // Legacy function override to do nothing as we use renderAdminListLogic now
        window.renderAdminList = () => {};

        window.downloadBackup = () => {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(window.finalRecipeList));
            const a = document.createElement('a');
            a.setAttribute("href", dataStr);
            a.setAttribute("download", "imperial_backup.json");
            document.body.appendChild(a);
            a.click();
            a.remove();
        };
        
        window.restoreBackup = (input) => {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = JSON.parse(e.target.result);
                window.firebaseRecipes = data;
                window.mergeAndRender();
                alert("Backup Restaurado!");
            };
            reader.readAsText(file);
        };

        // --- GLOBAL START ---
        window.populate(); // RESTAURADO: Gera 1000 receitas
        window.mergeAndRender();

        document.getElementById('searchInput').addEventListener('input', window.filterRecipes);
        document.getElementById('recipeModal').addEventListener('click', (e) => { if(e.target.id === 'recipeModal') window.closeModal(); });

        // --- MODAL L√ìGICA ---
        window.openRecipe = (id) => {
            const r = window.finalRecipeList.find(x => x.id == id);
            if(!r) return;
            window.currentModalRecipeId = id;
            document.getElementById('modalTitle').innerText = r.name;
            
            const img = document.getElementById('modalImage');
            img.src = r.image || window.DEFAULT_IMAGE;
            
            document.getElementById('modalDesc').innerText = r.desc || "Sem descri√ß√£o.";
            
            const ingList = document.getElementById('modalIngredients');
            ingList.innerHTML = (r.ingredients || []).map(i => `<li class="border-b border-stone-100 py-3 flex items-start"><i class="fas fa-check text-green-600 mt-1 mr-3 text-xs"></i><span>${i}</span></li>`).join('');
            
            const stepList = document.getElementById('modalSteps');
            stepList.innerHTML = (r.steps || []).map((s, i) => `
                <div class="mb-6 flex">
                    <div class="flex-shrink-0 w-8 h-8 bg-imperial-red text-white rounded-full flex items-center justify-center font-bold mr-4 text-sm font-serif shadow-sm">${i+1}</div>
                    <p class="pt-1 text-stone-700 leading-relaxed font-light">${s}</p>
                </div>
            `).join('');
            
            document.getElementById('modalTime').innerText = r.time || "30 min";
            document.getElementById('modalFunction').innerText = r.func || "Saboroso";

            window.updateModalHeart(id);
            document.getElementById('recipeModal').classList.remove('hidden');
        };

        window.closeModal = () => {
            document.getElementById('recipeModal').classList.add('hidden');
            const v = document.getElementById('modalVideo');
            if(v) v.pause();
        };
        
        window.toggleSaveRecipe = (id, e) => {
            if(e) e.stopPropagation();
            const sid = String(id);
            if(window.savedRecipesSet.has(sid)) window.savedRecipesSet.delete(sid);
            else window.savedRecipesSet.add(sid);
            window.updateSavedUI();
            window.toggleSaveRecipeDB(sid, window.savedRecipesSet.has(sid));
        };

        window.showSavedRecipes = () => window.setCategory('saved');
        window.resetApp = () => { window.setCategory('all'); document.getElementById('searchInput').value = ''; };

        window.toggleTTS = () => {
            const text = `${document.getElementById('modalTitle').innerText}. ${document.getElementById('modalDesc').innerText}`;
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'pt-BR';
            window.speechSynthesis.speak(u);
        };

        window.toggleTextZoom = () => {
             // Simples toggle de classes
             const el = document.getElementById('modalSteps');
             el.classList.toggle('text-lg');
             el.classList.toggle('text-2xl');
        };

        window.shareRecipeFromModal = () => {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => alert('Link copiado!'));
        };
    </script>

    <!-- Firebase Module -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, deleteDoc, collection, onSnapshot, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let app, auth, db, user;
        let firebaseConfig;
        
        // Inicializa√ß√£o "Blindada" contra erros de config
        try {
            if (typeof __firebase_config !== 'undefined') {
                firebaseConfig = JSON.parse(__firebase_config);
            } else {
                throw new Error("Configura√ß√£o Firebase n√£o encontrada.");
            }
            
            // Inicializa Firebase
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            // AUTH INIT
            const initAuth = async () => {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else if (!auth.currentUser) {
                    await signInAnonymously(auth);
                }
            };
            initAuth();

            // LISTENER
            onAuthStateChanged(auth, (u) => {
                user = u;
                window.isUserAdmin = !!u && !u.isAnonymous; 
                window.updateAuthUI(u);
                
                if(u) window.subscribeData(appId); // Pass appId safely
                
                // Atualiza Admin UI se estiver aberto
                const authOverlay = document.getElementById('adminAuthOverlay');
                if(authOverlay) {
                    if(window.isUserAdmin) authOverlay.classList.add('hidden');
                    else if(!document.getElementById('adminModal').classList.contains('hidden')) authOverlay.classList.remove('hidden');
                }
            });

        } catch(e) { 
            console.warn("Modo Offline ativado por erro na inicializa√ß√£o:", e);
            // Garante que a UI de loading suma mesmo com erro
            window.updateAuthUI(null); 
        }

        // Exports para Login Email/Senha
        window.handleEmailLogin = async () => {
            const email = document.getElementById('authEmail').value;
            const pass = document.getElementById('authPass').value;
            const btnText = document.getElementById('btnLoginText');
            const spinner = document.getElementById('authSpinner');

            if(!email || !pass) return alert("Por favor, preencha email e senha.");
            
            // UI Loading
            btnText.innerText = "Entrando...";
            spinner.classList.remove('hidden');

            try {
                if(!auth) throw new Error("Sistema offline. Login indispon√≠vel.");
                await signInWithEmailAndPassword(auth, email, pass);
            } catch(e) {
                let msg = "Erro desconhecido.";
                if(e.code === 'auth/wrong-password') msg = "Senha incorreta.";
                else if(e.code === 'auth/user-not-found') msg = "Usu√°rio n√£o encontrado. Crie uma conta abaixo.";
                else if(e.code === 'auth/invalid-email') msg = "Email inv√°lido.";
                else msg = e.message;
                alert("Falha no Login: " + msg);
            } finally {
                btnText.innerText = "Entrar com Email";
                spinner.classList.add('hidden');
            }
        };

        // Registro Explicito
        window.handleRegister = async () => {
            const email = document.getElementById('authEmail').value;
            const pass = document.getElementById('authPass').value;
            if(!email || !pass) return alert("Preencha email e senha para criar conta.");
            if(pass.length < 6) return alert("A senha deve ter pelo menos 6 caracteres.");

            try {
                if(!auth) throw new Error("Sistema offline.");
                await createUserWithEmailAndPassword(auth, email, pass);
                alert("Conta criada com sucesso! Voc√™ est√° logado como Admin.");
            } catch(e) {
                let msg = e.message;
                if(e.code === 'auth/email-already-in-use') msg = "Este email j√° est√° cadastrado.";
                alert("Erro ao Criar Conta: " + msg);
            }
        };

        window.handleLogout = async () => { 
            try { if(auth) await signOut(auth); } catch(e){} 
            window.location.reload(); 
        };

        window.updateAuthUI = (u) => {
            const loadEl = document.getElementById('loginLoading');
            if(loadEl) loadEl.classList.add('hidden');
            
            if(u && !u.isAnonymous) {
                document.getElementById('loginBtn').classList.add('hidden');
                document.getElementById('userProfile').classList.remove('hidden');
                
                const safeEmail = u.email || 'admin'; 
                const displayName = u.displayName || (u.email ? u.email.split('@')[0] : 'Administrador');

                document.getElementById('userPhoto').src = u.photoURL || `https://ui-avatars.com/api/?name=${safeEmail}&background=8B0000&color=fff`;
                document.getElementById('userName').innerText = displayName;
            } else {
                document.getElementById('loginBtn').classList.remove('hidden');
                document.getElementById('userProfile').classList.add('hidden');
            }
        };

        // CAMINHOS DE COLE√á√ÉO CORRIGIDOS (artifacts/{appId}/...)
        window.subscribeData = (currentAppId) => {
            if(!db) return;
            const col = collection(db, 'artifacts', currentAppId, 'public', 'data', 'recipes');
            
            onSnapshot(col, (snap) => {
                window.firebaseRecipes = [];
                snap.forEach(d => window.firebaseRecipes.push({id: d.id, ...d.data()}));
                window.mergeAndRender();
            }, (error) => {
                console.error("Erro ao carregar receitas:", error);
            });

            if(user) {
                const favCol = collection(db, 'artifacts', currentAppId, 'users', user.uid, 'favorites');
                onSnapshot(favCol, (snap) => {
                    window.savedRecipesSet.clear();
                    snap.forEach(d => window.savedRecipesSet.add(d.id));
                    window.updateSavedUI();
                }, (error) => { console.error("Erro favoritos", error); });
            }
        };

        window.saveRecipeToFirebase = async (r) => {
            if(!window.isUserAdmin || !db) return alert("Apenas Admins logados podem salvar (e verifique conex√£o).");
            const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const ref = doc(db, 'artifacts', currentAppId, 'public', 'data', 'recipes', r.id.toString());
            await setDoc(ref, r);
        };

        window.syncGeneratedToFirebase = async () => {
            if(!window.isUserAdmin || !db) return alert("Fa√ßa login para sincronizar.");
            if(!confirm("Isso enviar√° suas receitas locais para o banco de dados. Continuar?")) return;
            
            const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const batchSize = 400;
            const chunks = [];
            for (let i = 0; i < window.finalRecipeList.length; i += batchSize) {
                chunks.push(window.finalRecipeList.slice(i, i + batchSize));
            }

            for(const chunk of chunks) {
                const batch = writeBatch(db);
                chunk.forEach(r => {
                    const ref = doc(db, 'artifacts', currentAppId, 'public', 'data', 'recipes', r.id.toString());
                    batch.set(ref, r);
                });
                await batch.commit();
            }
            alert("Sincroniza√ß√£o completa!");
        };

        window.toggleSaveRecipeDB = async (id, isSaved) => {
            if(!user || !db) return;
            const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const ref = doc(db, 'artifacts', currentAppId, 'users', user.uid, 'favorites', id.toString());
            if(isSaved) await setDoc(ref, { savedAt: new Date() });
            else await deleteDoc(ref);
        };

        window.updateSavedUI = () => {
            document.getElementById('savedCountDropdown').innerText = window.savedRecipesSet.size;
            window.filterRecipes();
            if(window.currentModalRecipeId) window.updateModalHeart(window.currentModalRecipeId);
        };

        window.updateModalHeart = (id) => {
             const btn = document.getElementById('modalSaveBtn');
             if(!btn) return;
             const icon = btn.querySelector('i');
             const isFav = window.savedRecipesSet.has(String(id));
             icon.className = isFav ? 'fas fa-heart text-xl text-imperial-red' : 'far fa-heart text-xl';
             btn.className = `flex items-center space-x-2 px-5 py-2 rounded-full transition font-bold ${isFav ? 'bg-pink-50 text-imperial-red' : 'bg-stone-100 text-stone-600'}`;
        };
    </script>
</body>
</html>
